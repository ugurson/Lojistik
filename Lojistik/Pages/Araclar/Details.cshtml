@page
@model Lojistik.Pages.Araclar.DetailsModel

@{
    ViewData["Title"] = "Araç Detay";
}

<h2 class="mb-3">Araç Detay</h2>

@if (TempData["Msg"] is string msg)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @msg
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (Model.Arac is null)
{
    <div class="alert alert-warning">Kayıt bulunamadı.</div>
}
else
{
    <div class="container px-0">
        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Plaka</div>
            <div class="col-sm-6">@Model.Arac.Plaka</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Marka</div>
            <div class="col-sm-6">@Model.Arac.Marka</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Model</div>
            <div class="col-sm-6">@Model.Arac.Model</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Model Yılı</div>
            <div class="col-sm-6">@Model.Arac.ModelYili</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Araç Tipi</div>
            <div class="col-sm-6">@Model.Arac.AracTipi</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Dorse ise</div>
            <div class="col-sm-6">@(Model.Arac.IsDorse ? "Evet" : "Hayır")</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Durum</div>
            <div class="col-sm-6">@Model.Arac.Durum</div>
        </div>

        <div class="row mb-2">
            <div class="col-sm-2 fw-semibold">Notlar</div>
            <div class="col-sm-6">@Model.Arac.Notlar</div>
        </div>
    </div>

    <div class="mt-3">
        <a asp-page="./Edit" asp-route-id="@Model.Arac.AracID" class="btn btn-primary me-2">Düzenle</a>
        <a asp-page="./Delete" asp-route-id="@Model.Arac.AracID" class="btn btn-danger me-2">Sil</a>
        <a asp-page="./Index" class="btn btn-secondary">Listeye Dön</a>
    </div>

    <hr class="my-4" />

    <div class="d-flex align-items-center justify-content-between mb-2">
        <h4 class="m-0">Belgeler</h4>
        <a asp-page="/Belgeler/Create" asp-route-aracId="@Model.Arac.AracID" class="btn btn-success">
            Yeni Belge Ekle
        </a>
    </div>

    <table class="table table-striped table-bordered align-middle">
        <thead>
            <tr>
                <th>Belge Tipi</th>
                <th>Belge No</th>
                <th>Firma</th>
                <th>Başlangıç</th>
                <th>Bitiş</th>
                <th>Tutar</th>
                <th>Para</th>
                <th style="width: 220px;"></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var b in Model.Belgeler)
        {
            <tr>
                <td>@b.BelgeTipi</td>
                <td>@b.BelgeNo</td>
                <td>@b.Firma</td>
                <td>@b.BaslangicTarihi.ToString("dd-MM-yyyy")</td>
                <td>
                    @{
                        if (b.BitisTarihi.HasValue && b.BitisTarihi.Value <= DateOnly.FromDateTime(DateTime.Today.AddDays(30)))
                        {
                            <span style="color:red; font-weight:bold;">
                                @b.BitisTarihi.Value.ToString("dd-MM-yyyy") (yaklaşıyor!)
                            </span>
                        }
                        else
                        {
                            @(b.BitisTarihi?.ToString("dd-MM-yyyy") ?? "-")
                        }
                    }
                </td>
                <td>@(b.Tutar?.ToString("N2") ?? "-")</td>
                <td>@b.ParaBirimi</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Belge İşlemleri">
                        <a asp-page="/Belgeler/Details" asp-route-id="@b.BelgeID" class="btn btn-outline-secondary btn-sm me-1">Detay</a>    
                         <a asp-page="/Belgeler/Edit"    asp-route-id="@b.BelgeID" class="btn btn-outline-primary btn-sm me-1">Düzenle</a>                                           
                        <a asp-page="/Belgeler/Delete"  asp-route-id="@b.BelgeID" class="btn btn-outline-danger btn-sm me-1">Sil</a>
                             <!-- YENİ: Dosyayı Gör butonu -->
                @if (!string.IsNullOrEmpty(b.DosyaYolu))
                {
                    <a href="@b.DosyaYolu"
                       target="_blank" rel="noopener"
                       class="btn btn-success btn-sm">Görsel</a> <!-- YENİ -->
                }

                    </div>
                </td>
            </tr>
        }
        </tbody>
    </table>
}
